# Doctor Scheduling System PRD (原子级)

## 1. 文档概述
- **文档编号**: PRD-001
- **版本号**: V1.1
- **密级**: 内部保密
- **项目名称**: Doctor Scheduling System (医院智能排班与值班管理系统)
- **目标用户**: 全院医生 (60+人)、科室排班员、院级管理员

## 2. 核心业务流程
### 2.1 智能排班流程
1. **基础设置**: 管理员配置科室、人员、班次规则、约束条件。
2. **意愿收集**: 医生在移动端提交下月“不可用时间”及“意愿班次”。
3. **自动生成**: 系统基于规则算法+人员意愿，自动生成排班草稿。
   - **硬约束**: 必须满足（如间隔休息、资质搭配）。
   - **软约束**: 尽量满足（如工作量均衡、个人意愿）。
4. **人工干预**: 科室排班员微调草稿，系统实时校验冲突。
5. **发布生效**: 审核通过后发布，通知全员。

### 2.2 换班申请流程
1. **发起**: 医生A在移动端发起换班申请（指定日期+班次+目标医生B）。
2. **确认**: 医生B收到通知，确认同意或拒绝。
3. **审核**:
   - **自动通过**: 若无规则冲突且符合无需审批场景（可选）。
   - **人工审批**: 科室管理员/护士长审核（必选流程）。
4. **生效**: 班表更新，通知双方及关联人员。

## 3. 功能需求 (原子级)

### 3.1 Web 管理后台 (Admin)

#### 3.1.1 基础数据管理
- **科室管理**: 增删改查科室，支持层级结构（院区-大科-子科）。
- **人员管理**:
  - 字段: 姓名、工号、职称（住院医/主治/副高/正高）、手机号、所属科室。
  - 标签: 可设置特殊标签（如“孕期”、“带教老师”）。
- **班次定义**:
  - 类型: 白班、夜班（坐班）、听班、备班、节假日班。
  - 属性: 开始时间、结束时间、计分权重（用于工作量统计）、所需资质（如需主治带班）。

#### 3.1.2 智能排班引擎
- **规则配置**:
  - **强制规则 (Hard Constraint)**:
    - 连续值班限制 (值班后24h不可排班)。
    - 资质搭配 (夜班必须有1名主治医师)。
    - 人员互斥 (某两人不可同班)。
  - **软性规则 (Soft Constraint)**:
    - 班次均衡 (全月夜班数方差最小化)。
    - 尽量满足个人请假意愿。
- **一键排班**: 选择科室、月份，点击生成。
- **排班视图**: 日历视图/列表视图，支持拖拽调整。
- **冲突检测**: 实时高亮显示违反规则的排班（如某人连续夜班），并提示原因。

#### 3.1.3 审批管理
- **换班审批**: 列表展示换班申请，支持批量通过/驳回。
- **请假审批**: 审核医生的请假/不可用时间申请。

#### 3.1.4 统计报表
- **工作量统计**: 按月/季/年统计每人白班、夜班、听班时长及次数。
- **费用结算**: 基于班次权重和时长，自动计算值班费报表，支持Excel导出。

#### 3.1.5 系统管理
- **角色权限 (RBAC)**:
  - 超级管理员: 全权。
  - 院级领导: 全局查看，跨科室调度。
  - 科室管理员: 仅管理本科室排班与审核。
- **日志审计**: 记录所有排班修改、审核操作。

### 3.2 微信小程序 / iOS App (Doctor End)

#### 3.2.1 班表查看
- **我的班表**: 月视图展示个人排班，高亮当前日期。
- **全科班表**: 查看所在科室整体排班，便于了解同事动向。
- **班次详情**: 点击班次查看具体时间、搭档医生、备注信息。

#### 3.2.2 业务办理
- **意愿申报**:
  - 提交下月“不可用日期”（如学术会议、婚假）。
  - 提交“意愿班次”（如希望周三值夜班）。
- **自助换班**:
  - 发起换班：选择自己的班次 -> 选择目标医生 -> 提交。
  - 处理换班：收到换班请求 -> 同意/拒绝。
  - 进度追踪：查看换班申请的审批状态。

#### 3.2.3 消息通知
- **排班发布通知**: 新班表发布时推送。
- **换班动态**: 收到请求、对方确认、审批结果推送。
- **值班提醒**: 班次开始前 (如2小时) 自动提醒。

### 3.3 国际化 (i18n) [新增]

#### 3.3.1 语言支持
- **首发语言**: 简体中文 (zh-CN), 英文 (en-US)。
- **扩展性**: 设计时需预留扩展其他语言包的能力。

#### 3.3.2 前端实现
- **Web 端**: 使用 `vue-i18n` 管理多语言资源。
- **移动端**: 适配 iOS 系统语言设置或应用内切换。
- **切换方式**: 支持用户在“设置”中手动切换语言。

#### 3.3.3 后端支持
- **API 响应**: 错误信息和提示语需根据请求头 `Accept-Language` 返回对应语言。
- **数据存储**: 静态字典数据（如班次类型、角色名称）建议使用 Key 存储，前端进行翻译；动态内容（如公告）暂只支持录入语言。

## 4. 非功能性需求 (NFR)

### 4.1 安全性
- **私有化部署**: 系统完整部署在医院内网服务器，数据库不直接暴露公网。
- **网络访问**: Web端通过医院VPN访问；移动端API通过安全网关（API Gateway）映射，仅开放必要端口，且绑定设备ID。
- **数据加密**: 敏感字段（手机号、身份证）数据库加密存储；传输层使用HTTPS。

### 4.2 性能
- **并发**: 支持60+医生同时在线查看班表，响应时间 < 1秒。
- **算法效率**: 自动排班算法（60人/月）计算时间 < 30秒。

### 4.3 兼容性
- **iOS**: 支持 iOS 15.0 及以上。
- **小程序**: 兼容微信最新版本。
- **Web**: 支持 Chrome, Edge, Firefox 主流浏览器。

## 5. 项目交付物
1. 需求规格说明书 (PRD)
2. UI/UX 设计原型 (Web + Mobile)
3. 数据库设计文档 (ER图)
4. API 接口文档
5. 源代码 (前端、后端、移动端)
6. 测试报告 & 用户操作手册
